import { AppButton } from "AppButton.slint";
import { AnswerButton } from "AnswerButton.slint";
import { VerticalBox } from "std-widgets.slint";
import { Logo } from "Logo.slint";

export component TriviaScreen inherits Rectangle {
    width: 100%;
    height: 100%;
    background: #FF3900;

    // Logo with absolute positioning
    Logo {
        x: (parent.width - 800px) / 2;
        y: 20px;
    }

    // Content in VerticalBox, starting below logo
    VerticalLayout {
        width: parent.width;
        alignment: center;

        // Trivia name
        Text {
            text: trivia_name == "TRIVIA 1" ? "TU CALLROOM FAVORITO" : trivia_name == "TRIVIA 2" ? "TU SALA FAVORITA" : trivia_name;
            font-size: 75px;
            font-weight: 800;
            horizontal-alignment: center;
            vertical-alignment: center;
            color: black;
            wrap: word-wrap;
            width: 50%;
            font-family: "Montserrat";
        }

        if !quiz_finished: VerticalLayout {
            width: 100%;
            spacing: 50px;
            alignment: center;
            Text {
                text: questions[current_question];
                font-size: 45px;
                font-weight: 800;
                horizontal-alignment: center;
                wrap: word-wrap;
                width: 80%;
                font-family: "Montserrat";
                color: white;
            }
            HorizontalLayout {
                alignment: center;
            VerticalLayout { // Removed unnecessary Rectangle, simplified to VerticalLayout
                spacing: 50px;
                alignment: center;
                
                for answer[idx] in answers[current_question] : AnswerButton {
                    text: answer;
                    enabled: !answered;
                    width: 600px;
                    height: 80px;
                    font-weight: 100;
                    text-color: white;
                    background: black;
                    clicked => {
                        if (idx == correct_answers[current_question]) {
                            score += 5;
                        }
                        answered = true;
                        if (current_question < questions.length - 1) {
                            current_question += 1;
                            answered = false;
                        } else {
                            quiz_finished = true;
                            submit_score(score);
                        }
                    }
                }
            }
        }
        }

        if quiz_finished: VerticalLayout {
            width: 100%;
            spacing: 100px;
            alignment: center;
            VerticalLayout {
                spacing: 20px;
                alignment: center;
                Text {
                text: "\{floor(score/5)} RESPUESTAS CORRECTAS";
                font-size: 45px;
                horizontal-alignment: center;
                wrap: word-wrap;
                width: 50%;
                font-weight: 800;
            }
            Text {
                text: "SUMASTE";
                color: white;
                font-size: 45px;
                horizontal-alignment: center;
                wrap: word-wrap;
                width: 50%;
                font-weight: 800;
            }
            Text {
                text: "\{score}";
                color: white;
                font-size: 120px;
                horizontal-alignment: center;
                wrap: word-wrap;
                width: 50%;
                font-weight: 1500;
            }
            Text {
                text: "PUNTOS";
                color: white;
                font-size: 45px;
                horizontal-alignment: center;
                wrap: word-wrap;
                width: 50%;
                font-weight: 800;
            }
            Text {
                text: "Â¡GRACIAS POR PARTICIPAR!";
                font-size: 45px;
                horizontal-alignment: center;
                wrap: word-wrap;
                width: 50%;
                font-weight: 800;
            }
            }
            
            HorizontalLayout {
                alignment: center;
            VerticalBox {
                padding-top: 100px;
                spacing: 100px;
                alignment: center;
                AppButton {
                    text: "PARTICIPAR DE OTRA TRIVIA";
                    width: 600px;
                    height: 80px;
                    background: transparent;
                    text-color: black;
                    clicked => {
                        root.return-to-quiz-select();
                    }
                }
                AppButton {
                    text: "VOLVER AL INICIO";
                    width: 600px;
                    height: 80px;
                    background: transparent;
                    text-color: black;
                    clicked => {
                        root.return-to-start();
                    }
                }
            }
        }
        }
    }

    in property <[string]> questions;
    in property <[[string]]> answers;
    in property <[int]> correct_answers;
    in property <string> trivia_name;
    callback return-to-start;
    callback return-to-quiz-select;
    callback submit_score(string);
    in-out property <int> score: 0;
    in-out property <bool> answered: false;
    in-out property <int> current_question: 0;
    in-out property <bool> quiz_finished: false;
}